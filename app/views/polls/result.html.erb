<% @page_title = @poll.title %>

<h1><%= @page_title %></h1>

</p>

<div id="chart">
  <canvas id="myChart" width="400" height="200"></canvas>
</div>

<table>
  <tr>
    <th>質問タイトル</th>
    <td><%= @poll.title %></td>
  </tr>
  <tr>
    <th>質問詳細</th>
    <td><%= @poll.question %></td>
  </tr>
  <tr>
    <th>選択肢</th>
    <td>
      <ul>
        <li><%= @poll.choice01 %></li>
        <li><%= @poll.choice02 %></li>
        <li><%= @poll.choice03 %></li>
        <li><%= @poll.choice04 %></li>
        <li><%= @poll.choice05 %></li>
        <li><%= @poll.choice06 %></li>
        <li><%= @poll.choice07 %></li>
        <li><%= @poll.choice08 %></li>
      </ul>
    </td>
  </tr>
</table>


<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.js"></script>
<script type="text/javascript">
  var keyArray = [];
  var valueArray = [];

  <% @answers.each do |key,value| %>
  keyArray.push('<%= key %>');
  valueArray.push('<%= value %>');
  <% end %>

  var data = {
    labels: keyArray,
    datasets: [
      {
        label: "My First dataset",
        fillColor: "rgba(220,220,220,0.5)",
        strokeColor: "rgba(220,220,220,0.8)",
        highlightFill: "rgba(220,220,220,0.75)",
        highlightStroke: "rgba(220,220,220,1)",
        data: valueArray
      }
    ]
  };

  var ctx = document.getElementById("myChart").getContext("2d");
  new Chart(ctx).Bar(data, {
    scaleBeginAtZero: true,

    //Boolean - Whether grid lines are shown across the chart
    scaleShowGridLines: true,

    //String - Colour of the grid lines
    scaleGridLineColor: "rgba(0,0,0,.05)",

    //Number - Width of the grid lines
    scaleGridLineWidth: 1,

    //Boolean - Whether to show horizontal lines (except X axis)
    scaleShowHorizontalLines: true,

    //Boolean - Whether to show vertical lines (except Y axis)
    scaleShowVerticalLines: true,

    //Boolean - If there is a stroke on each bar
    barShowStroke: true,

    //Number - Pixel width of the bar stroke
    barStrokeWidth: 2,

    //Number - Spacing between each of the X value sets
    barValueSpacing: 5,

    //Number - Spacing between data sets within X values
    barDatasetSpacing: 1
  });

  console.log(keyArray);
  console.log(valueArray);

</script>

<% @answers.each do |key, value| %>
  <p>
    <%= key %> →
    <%= value %>
  </p>
<% end %>

<!-- チャット表示部分 -->

<ul id="chat_area">

</ul>



<!-- コメントフォーム -->

<input id="comment" type="text">

<input id="send" type="button" value="send">



<script>

  var ws_rails = new WebSocketRails("localhost:3000/websocket");
  var websocket_chat_channel = ws_rails.subscribe("websocket_chat_channel");

  websocket_chat_channel.bind("websocket_chat", function(message){
    var message_li = document.createElement("li");
    message_li.textContent = message;

    document.getElementById("chat_area").appendChild(message_li);
  });

  document.getElementById("send").onclick = function(){
    var comment = document.getElementById("comment").value;

    // この一行を変更
    // ws_rails.trigger("websocket_chat", comment);
    websocket_chat_channel.trigger("websocket_chat", comment);
  }
</script>
<p id="time"><%= @time %></p>
<script type="text/javascript" charset="utf-8">
/*  var update;

  $(function() {
    var timer;
    return timer = setInterval(function() {
      return update();
    }, 5000);
  });

  update = function() {
    $.ajax({
      url: 'polls/ajax_action',
      type: 'GET'
    });
  };*/
</script>